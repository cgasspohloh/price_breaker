(()=>{"use strict";function t(t,e){const n=e.dataFromMcDavid.sections;let o=n.findIndex((e=>e.sectionId==t));return n[o].section}function e(t){const e=document.getElementById("eventName"),n=document.getElementById("eventDate"),o=document.getElementById("location"),a=document.getElementById("eventLink");e.textContent="",n.textContent="",o.textContent="",a.href="",a.textContent="",t&&t.name&&t.date&&t.location&&t.urlLink?(e.textContent=t.name,n.textContent="Date: "+t.date,o.textContent="Location: "+t.location,a.href=t.urlLink,a.textContent="  Ticketmaster Link"):e.textContent="Event details not available on Bowman"}function n(t){const e=document.getElementById("result");e.innerHTML="";const n=document.createElement("table");n.classList.add("data-table");const o=document.createElement("thead"),a=document.createElement("tr");a.innerHTML="<th>Ticket Type</th><th>Section</th><th>Unit Cost</th><th>Unit Fees</th><th>Total Cost</th>",o.appendChild(a),n.appendChild(o);const c=document.createElement("tbody"),d={};t.forEach((t=>{const e={sectionName:t.sectionName,unitCost:t.unitCost,unitFees:t.unitFees,totalCost:t.totalCost};d[t.ticketTypeId]||(d[t.ticketTypeId]={sections:[]}),d[t.ticketTypeId].ticketTypeName=t.ticketTypeName,d[t.ticketTypeId].sections.push(e)}));for(const t in d)d[t].sections.sort(((t,e)=>{const n=t.sectionName||"",o=e.sectionName||"",a=n.match(/(\D+)|(\d+)/g),c=o.match(/(\D+)|(\d+)/g);for(let t=0;t<Math.min(a.length,c.length);t++){const e=a[t],n=c[t];if(isNaN(e)||isNaN(n)){const t=e.localeCompare(n);if(0!==t)return t}else{const t=parseFloat(e),o=parseFloat(n);if(t!==o)return t-o}}return n.length-o.length}));const i=Object.keys(d).sort(((t,e)=>{const n=d[t].ticketTypeName||"",o=d[e].ticketTypeName||"";return n.localeCompare(o)}));for(const t of i){const e=document.createElement("tr");e.classList.add("collapsible",s(t)),e.innerHTML=`<td>${d[t].ticketTypeName}</td><td></td><td></td><td></td><td></td>`,c.appendChild(e),d[t].sections.forEach((({sectionName:e,unitCost:n,unitFees:o,totalCost:a})=>{const d=document.createElement("tr");d.classList.add("content",s(t)),d.style.display="none",d.innerHTML=`<td></td><td>${e}</td><td>$${n}</td><td>$${o}</td><td>$${a}</td>`,c.appendChild(d)})),e.addEventListener("click",(function(){const e=document.querySelectorAll(`.content.${s(t)}`);for(let t=0;t<e.length;t++)e[t].style.display="table-row"===e[t].style.display?"none":"table-row"}))}function s(t){return`_${t.replace(/[^\w]/g,"_")}`}n.appendChild(c),e.appendChild(n)}let o,a,c;const d=document.getElementById("event-container");document.getElementById("eventIdForm").addEventListener("submit",(async d=>{d.preventDefault();const i=document.getElementById("eventId").value;try{const d=await fetch("/fetchData",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventId:i})});if(!d.ok)throw new Error("Error fetching data");o=await d.json(),a=function(t){if(!t||!t.dataFromBowman||!t.dataFromBowman.event)return;const e=t.dataFromBowman.event;return{name:e.event_name,date:e.event_date,location:`At the ${e.venue_name} in beautiful ${e.city}`,urlLink:"https://www.ticketmaster.com/event/"+e.url_id,eventId:e.url_id}}(o),c=function(e){let n=[];return e.dataFromMcDavid.detailed.forEach((o=>{let a={ticketTypeId:o.ticket_type_id,ticketTypeName:o.ticket_type_name,sectionName:t(o.section_id,e),unitCost:Math.round(100*o.unit_cost)/100,unitFees:Math.round(100*o.unit_fees)/100,totalCost:Math.round(100*(o.unit_cost+o.unit_fees))/100};n.push(a)})),n}(o),function(t,e){const n=document.createElement("div");n.id=t.eventId,n.classList.add("savedEvent"),n._savedNewEvent=t,n._savedEventListings=e;const o=document.createElement("button");o.classList.add("deleteEventButton"),o.textContent="X",o.addEventListener("click",(function(){n.remove()})),n.appendChild(o);const a=document.createElement("h3");a.classList.add("eventName","eventInfo"),a.textContent=t.name,n.appendChild(a);const c=document.createElement("p");c.classList.add("eventDate","eventInfo"),c.textContent=t.date,n.appendChild(c);const d=document.createElement("p");d.classList.add("eventLocation","eventInfo"),d.textContent=t.location,n.appendChild(d),n.addEventListener("click",(function(){n._savedNewEvent,n._savedEventListings})),document.getElementById("event-container").appendChild(n)}(a,c),e(a),n(c)}catch(t){console.error("Error:",t.message)}})),d.addEventListener("click",(t=>{const o=t.target.closest(".savedEvent");if(o){const t=o._savedNewEvent,a=o._savedEventListings;e(t),n(a)}}))})();