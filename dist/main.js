(()=>{"use strict";function t(t,e){const n=e.dataFromMcDavid.sections;let o=n.findIndex((e=>e.sectionId==t));return n[o].section}function e(t){const e=document.getElementById("eventName"),n=document.getElementById("eventDate"),o=document.getElementById("location"),c=document.getElementById("eventLink");e.textContent="",n.textContent="",o.textContent="",c.href="",c.textContent="",t&&t.name&&t.date&&t.location&&t.urlLink?(e.textContent=t.name,n.textContent="Date: "+t.date,o.textContent="Location: "+t.location,c.href=t.urlLink,c.textContent="  Ticketmaster Link"):e.textContent="Event details not available on Bowman"}function n(t){const e=document.getElementsByClassName("savedEvent");for(let t=0;t<e.length;t++)e[t].classList.remove("clicked");t.classList.add("clicked")}function o(t){const e=document.getElementById("result");e.innerHTML="";const n=document.createElement("table");n.classList.add("data-table");const o=document.createElement("thead"),c=document.createElement("tr");c.innerHTML="<th>Ticket Type</th><th>Section</th><th>Unit Cost</th><th>Unit Fees</th><th>Total Cost</th>",o.appendChild(c),n.appendChild(o);const s=document.createElement("tbody"),a={};t.forEach((t=>{const e={sectionName:t.sectionName,unitCost:t.unitCost,unitFees:t.unitFees,totalCost:t.totalCost};a[t.ticketTypeId]||(a[t.ticketTypeId]={sections:[]}),a[t.ticketTypeId].ticketTypeName=t.ticketTypeName,a[t.ticketTypeId].sections.push(e)}));for(const t in a)a[t].sections.sort(((t,e)=>{const n=t.sectionName||"",o=e.sectionName||"",c=n.localeCompare(o);return 0!==c?c:t.unitCost-e.unitCost}));for(const t of Object.keys(a).sort(((t,e)=>{const n=a[t].ticketTypeName||"",o=a[e].ticketTypeName||"";return n.localeCompare(o)}))){const e=document.createElement("tr");e.classList.add("collapsible",d(t)),e.innerHTML=`<td class="first-col">${a[t].ticketTypeName}</td><td></td><td></td><td></td><td></td>`,s.appendChild(e);const n={};a[t].sections.forEach((({sectionName:e,unitCost:o,unitFees:c,totalCost:a})=>{const i=document.createElement("tr");i.classList.add("content",d(t)),i.style.display="none",i.innerHTML=`<td></td><td>${e}</td><td>$${o}</td><td>$${c}</td><td>$${a}</td>`,s.appendChild(i),(!n[e]||o<n[e].unitCost)&&(n[e]&&n[e].row.classList.remove("cheapest"),i.classList.add("cheapest","display"),n[e]={unitCost:o,row:i})})),e.querySelector(".first-col").addEventListener("click",(function(){const e=document.querySelectorAll(`.content.${d(t)}`),n=document.querySelectorAll(`.content.${d(t)}.display`);for(let t=0;t<n.length;t++)n[t].style.display="table-row"===n[t].style.display?"none":"table-row";for(let t=0;t<e.length;t++)e[t].classList.toggle("expanded")}))}function d(t){return`_${t.replace(/[^\w]/g,"_")}`}n.appendChild(s),e.appendChild(n)}let c,s,a;const d=document.getElementById("event-container");document.getElementById("eventIdForm").addEventListener("submit",(async d=>{d.preventDefault(),async function(d){try{const i=await fetch("/fetchData",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventId:d})});if(!i.ok)throw new Error("Error fetching data");c=await i.json(),s=function(t){if(!t||!t.dataFromBowman||!t.dataFromBowman.event)return;const e=t.dataFromBowman.event;return{name:e.event_name,date:e.event_date.substring(0,10),location:`At the ${e.venue_name} in beautiful ${e.city}`,urlLink:"https://www.ticketmaster.com/event/"+e.url_id,eventId:e.url_id,city:e.city}}(c),a=function(e){let n=[];return e.dataFromMcDavid.detailed.forEach((o=>{let c={ticketTypeId:o.ticket_type_id,ticketTypeName:o.ticket_type_name,sectionName:t(o.section_id,e),unitCost:Math.round(100*o.unit_cost)/100,unitFees:Math.round(100*o.unit_fees)/100,totalCost:Math.round(100*(o.unit_cost+o.unit_fees))/100};n.push(c)})),n}(c),function(t,e){const o=document.createElement("div");o.id=t.eventId,o.classList.add("savedEvent"),n(o),o._savedNewEvent=t,o._savedEventListings=e;const c=document.createElement("button");c.classList.add("deleteEventButton"),c.textContent="X",c.addEventListener("click",(function(){o.remove()})),o.appendChild(c);const s=document.createElement("h3");s.classList.add("eventName","eventInfo"),s.textContent=t.name,o.appendChild(s);const a=document.createElement("p");a.classList.add("eventDate","eventInfo"),a.textContent=t.date,o.appendChild(a);const d=document.createElement("p");d.classList.add("eventLocation","eventInfo"),d.textContent=t.city,o.appendChild(d),o.addEventListener("click",(function(){o._savedNewEvent,o._savedEventListings})),document.getElementById("event-container").appendChild(o)}(s,a),e(s),o(a)}catch(t){console.error("Error:",t.message)}}(document.getElementById("eventIdInput").value)})),document.addEventListener("DOMContentLoaded",(function(){document.getElementById("refetchAllButton").addEventListener("click",(function(){}))})),d.addEventListener("click",(t=>{const c=t.target.closest(".savedEvent");if(n(c),c){const t=c._savedNewEvent,n=c._savedEventListings;e(t),o(n)}}));const i=document.getElementById("cheapest-toggle");let l=!0;i.addEventListener("change",(function(){l=!l,function(t){document.querySelectorAll(".cheapest");const e=document.querySelectorAll("tr.content");t?e.forEach((t=>{t.classList.contains("cheapest")||t.classList.remove("display")})):e.forEach((t=>{t.classList.add("display")})),e.forEach((t=>{t.classList.contains("expanded")&&t.classList.contains("display")?t.style.display="table-row":t.style.display="none"}))}(l)}))})();